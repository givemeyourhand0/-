### 《MYSQL技术内幕——InnoDB存储引擎》读书笔记

#### 一、OLTP和OLAP

当今的数据处理大致可以分成两大类：

**联机事务处理OLTP（on-line transaction processing）**、

**联机分析处理OLAP（On-Line Analytical Processing）**。

- OLTP是传统的关系型数据库的主要应用，主要是基本的、日常的事务处理，例如银行交易。
- OLAP是数据仓库系统的主要应用，支持复杂的分析操作，侧重决策支持，并且提供直观易懂的查询结果.
- OLTP:也称为面向交易的处理系统，其基本特征是顾客的原始数据可以立即传送到计算中心进行处理，并在很短的时间内给出处理结果。这样做的最大优点是可以即时地处理输入的数据，及时地回答。也称为实时系统(Real time System)。衡量联机事务处理系统的一个重要性能指标是系统性能，具体体现为实时响应时间(Response Time)，即用户在终端上送入数据之后，到计算机对这个请求给出答复所需要的时间。OLTP是由数据库引擎负责完成的。OLTP 数据库旨在使事务应用程序仅写入所需的数据，以便尽快处理单个事务。
- OLAP:简写为OLAP,随着数据库技术的发展和应用，数据库存储的数据量从20世纪80年代的兆（M）字节及千兆（G）字节过渡到现在的兆兆（T）字节和千兆兆（P）字节，同时，用户的查询需求也越来越复杂，涉及的已不仅是查询或操纵一张关系表中的一条或几条记录，而且要对多张表中千万条记录的数据进行数据分析和信息综合，关系数据库系统已不能全部满足这一要求。在国外，不少软件厂商采取了发展其前端产品来弥补关系数据库管理系统支持的不足，力图统一分散的公共应用逻辑，在短时间内响应非数据处理专业人员的复杂查询要求。
- 联机分析处理（OLAP）系统是数据仓库系统最主要的应用，专门设计用于支持复杂的分析操作，侧重对决策人员和高层管理人员的决策支持，可以根据分析人员的要求快速、灵活地进行大数据量的复杂查询处理，并且以一种直观而易懂的形式将查询结果提供给决策人员，以便他们准确掌握企业（公司）的经营状况，了解对象的需求，制定正确的方案。

#### 二、联合索引

> 联合索引是指对表上的多个列进行索引。

以下为建立联合索引的代码

```
create table t(
	a int,
	b int,
	primary key (a),
	key idx_a_b (a,b)
)engine=INNODB
```

##### 2.1 什么时候会用到联合索引？

- 先看一下联合索引内部的结构，本质上说，联合索引也是一颗B+树，不同的是联合索引的键值数量不是1，而是大于等于2。以下是两个整型列组成的联合索引：

  ![联合索引多个键值的B+树](E:\笔记\刷笔试题记录\图片\联合索引多个键值的B+树.JPG)

  通过叶子节点可以逻辑上顺序读出所有数据：

  （1，1）（1，2）（2，1）（2，4）（3，1）（3，2）

  所以

  `select * from table where a=xxx and b=xxx`显然使用到了该联合索引。

  `select * from table where a=xxx`也使用到了该联合索引，因为a按照顺序排列。

  但是`select * from table where b=xxx`却没有用到该索引，因为b不是按照顺序排列。

  再比如有这样一个索引(a,b,c)

  `select ...from table where a=xxx  order by b`同样用到该联合索引

  `select ...form table where a=xxx and b=xxx order by c`也同样用的该索引

  `select ...from table where a=xxx order by c`对于该语句联合索引不能得到最终结果，还需要一次filesort排序操作，因为索引(a,c)并未排序。

- 联合索引的第二个好处就是已经对第二个键值进行了排序处理

  这在某些场景很有用，比如查询某个用户的购物情况并且按时间排序，最后取出最近三次的购物记录，这时使用联合索引可以避免多一次的排序操作，因为索引本身在叶子节点已经排序了。

##### 2.2覆盖索引

> InnoDB存储引擎支持覆盖索引(covering index，或者叫索引覆盖)，即从辅助索引中就可以得到查询的记录，而不需要查询聚集索引中的数据。

- 使用覆盖索引的一个好处是辅助索引不包含整行记录的所有信息，故其大小要远小于聚集索引，因此可以减少IO操作。

- 覆盖索引的另一个好处就是对于某个统计问题而言。如下图：

  ![覆盖索引1](E:\笔记\刷笔试题记录\图片\覆盖索引1.JPG)

  ![覆盖索引2](E:\笔记\刷笔试题记录\图片\覆盖索引2.JPG)

  ​

#### 三、优化器选择不使用索引的情况

![优化器选择不使用索引1](E:\笔记\刷笔试题记录\图片\优化器选择不使用索引1.JPG)

![优化器选择不使用索引2](E:\笔记\刷笔试题记录\图片\优化器选择不使用索引2.JPG)

![优化器选择不使用索引3](E:\笔记\刷笔试题记录\图片\优化器选择不使用索引3.JPG)

####四、索引提示

![索引提示](E:\笔记\刷笔试题记录\图片\索引提示.JPG)

##### 	USE INDEX

​		USE INDEX 只是告诉优化器可以选择该索引，实际上还是会根据自己的判断进行选择。

##### 	FORCE INDEX

​		FORCE INDEX则是指定优化器使用该索引。

​		所以最靠谱的还是FORCE INDEX

#### 未完待续。。。







